{
    "author": "Anaren Inc.",
    "categories": [
        "Lightning",
        "Sensor"
    ],
    "code": {
        "connected": "",
        "global": "",
        "interval": "",
        "setup": "\tAS3935_Init();\n"
    },
    "config": {
        "file": "as3935_config.h",
        "values": {
            "analog_front_end": {
                "input": "Combo",
                "name": "Analog Front End",
                "options": [
                    "INDOOR",
                    "OUTDOOR"
                ],
                "prefix": "#define AIR_AS3935_ANALOG_FRONT_END AS3935_AFE_",
                "regex": "^[a-zA-Z0-9_.]*$",
                "value": "INDOOR"
            },
            "i2c_address": {
                "input": "Combo",
                "name": "I2C Address (7 bit)",
                "options": [
                    "0x03",
                    "0x02",
                    "0x01",
                    "0x00"
                ],
                "prefix": "#define AS3935_I2C_ADDRESS ",
                "regex": "^[a-zA-Z0-9_.]*$",
                "value": "0x03"
            },
            "irq_pin": {
                "input": "TextField",
                "name": "IRQ Pin",
                "prefix": "#define AS3935_IRQ_PIN ",
                "regex": "^[0-9]*$|^D[0-9]*$|^A[0-9]*$",
                "value": "D3"
            }
        }
    },
    "description": "What if you need to know when the approaching storm is going to be overhead?\n The MOD-1016, based on the AS3935 from AMS, can detect storm front up to 40km away.\n Trigger interrupts on your microcontroller to let you know about weather events and changes in storm distance,\n you can even tell as storm fronts move closer or further away.",
    "elements": {
        "detectLightning": {
            "code": "    /**\n    Detect oncoming lightning storm fronts up to 40km away.\n    @param id device ID (0 to 7) on i2c bus.\n    @return Estimated distance of storm front in km.\n    */\n    return AS3935_GetDistanceEstimation();\n",
            "icon": "data:image/png;base64,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\nAAAAAElFTkSuQmCC\n",
            "inputType": "void",
            "label": "Detect Lightning",
            "language": {
                "en": {
                    "label": "Detect Lightning"
                }
            },
            "returnType": "int"
        }
    },
    "files": {
        "common": {
            "headers": {
                "as3935.h": "// Copyright (c) 2016, Anaren Inc.\n// All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are met:\n//\n// 1. Redistributions of source code must retain the above copyright notice, this\n//\t\tlist of conditions and the following disclaimer.\n// 2. Redistributions in binary form must reproduce the above copyright notice,\n//\t\tthis list of conditions and the following disclaimer in the documentation\n//\t\tand/or other materials provided with the distribution.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n// ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n// WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n// DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n// ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n// (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n// LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n// ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n//\n// The views and conclusions contained in the software and documentation are those\n// of the authors and should not be interpreted as representing official policies,\n// either expressed or implied, of the FreeBSD Project.\n\n#ifndef AS3935_H\n#define AS3935_H\n\n#include \"as3935_config.h\"\n#include <stdint.h>\n\n//------------------------------------------------------------------------------\n/**\n *\tDefines, enumerations, and structure definitions\n */\n#ifndef bool\n#define bool uint8_t\n#endif\n\n#ifndef true\n#define true 1\n#endif\n\n#ifndef false\n#define false 0\n#endif\n\n//------------------------------------------------------------------------------\n/**\n *\tDefines, enumerations, and structure definitions\n */\n\n//The MOD-1016 Board uses I2C Address 0x03 since both SD0 and SD1 pins are pulled high.\n#define AS3935_I2C_BASE_ADDR\t\t\t\t\t0x03\n\n#define AS3935_PWD_AFEGB_REG_ADDR\t\t 0x00\n#define AS3935_NFLV_WDTH_REG_ADDR\t\t 0x01\n#define AS3935_MIN_LIGHT_REG_ADDR\t\t 0x02\n#define AS3935_MASK_DIST_REG_ADDR\t\t 0x03\n#define AS3935_LIGHT_LSB_REG_ADDR\t\t 0x04\n#define AS3935_LIGHT_MSB_REG_ADDR\t\t 0x05\n#define AS3935_LIGHT_MMS_REG_ADDR\t\t 0x06\n#define AS3935_DIST_ESTI_REG_ADDR\t\t 0x07\n#define AS3935_DISP_IRQ_REG_ADDR\t\t\t0x08\n\n//Lightning Detection Lookup Table\n#define AS3935_LDLUT1_REG_ADDR\t\t\t\t0x09\n#define AS3935_LDLUT2_REG_ADDR\t\t\t\t0x0A\n#define AS3935_LDLUT3_REG_ADDR\t\t\t\t0x0B\n#define AS3935_LDLUT4_REG_ADDR\t\t\t0x0C\n#define AS3935_LDLUT5_REG_ADDR\t\t\t\t0x0D\n#define AS3935_LDLUT6_REG_ADDR\t\t\t\t0x0E\n#define AS3935_LDLUT7_REG_ADDR\t\t\t0x0F\n#define AS3935_LDLUT8_REG_ADDR\t\t\t0x10\n#define AS3935_LDLUT9_REG_ADDR\t\t\t0x11\n#define AS3935_LDLUT10_REG_ADDR\t\t\t0x12\n#define AS3935_LDLUT11_REG_ADDR\t\t\t0x13\n#define AS3935_LDLUT12_REG_ADDR\t\t\t0x14\n#define AS3935_LDLUT13_REG_ADDR\t\t\t0X15\n#define AS3935_LDLUT14_REG_ADDR\t\t\t0X16\n#define AS3935_LDLUT15_REG_ADDR\t\t\t0X17\n#define AS3935_LDLUT16_REG_ADDR\t\t\t0X18\n#define AS3935_LDLUT17_REG_ADDR\t\t\t0X19\n#define AS3935_LDLUT18_REG_ADDR\t\t\t0X1A\n#define AS3935_LDLUT19_REG_ADDR\t\t\t0X1B\n#define AS3935_LDLUT20_REG_ADDR\t\t\t0X1C\n#define AS3935_LDLUT21_REG_ADDR\t\t\t0X1D\n#define AS3935_LDLUT22_REG_ADDR\t\t\t0X1E\n#define AS3935_LDLUT23_REG_ADDR\t\t\t0X1F\n#define AS3935_LDLUT24_REG_ADDR\t\t\t0X20\n#define AS3935_LDLUT25_REG_ADDR\t\t\t0X21\n#define AS3935_LDLUT26_REG_ADDR\t\t\t0X22\n#define AS3935_LDLUT27_REG_ADDR\t\t\t0X23\n#define AS3935_LDLUT28_REG_ADDR\t\t\t0X24\n#define AS3935_LDLUT29_REG_ADDR\t\t\t0X25\n#define AS3935_LDLUT30_REG_ADDR\t\t\t0X26\n#define AS3935_LDLUT31_REG_ADDR\t\t\t0X27\n#define AS3935_LDLUT32_REG_ADDR\t\t\t0X28\n#define AS3935_LDLUT33_REG_ADDR\t\t\t0X29\n#define AS3935_LDLUT34_REG_ADDR\t\t\t0X2A\n#define AS3935_LDLUT35_REG_ADDR\t\t\t0X2B\n#define AS3935_LDLUT36_REG_ADDR\t\t\t0X2C\n#define AS3935_LDLUT37_REG_ADDR\t\t\t0X2D\n#define AS3935_LDLUT38_REG_ADDR\t\t\t0X2E\n#define AS3935_LDLUT39_REG_ADDR\t\t\t0X2F\n#define AS3935_LDLUT40_REG_ADDR\t\t\t0X30\n#define AS3935_LDLUT41_REG_ADDR\t\t\t0X31\n#define AS3935_LDLUT42_REG_ADDR\t\t\t0X32\n\n/**\n * It is possible to send direct commands writing 0x96 to the registers\n * REG0x3C and REG0x3D.\n */\n#define AS3935_PRESET_DEF_REG_ADDR\t\t0x3C\n#define AS3935_CALIBR_RCO_REG_ADDR\t\t0x3D\n#define AS3935_DIRECT_CMD_REG_VALU\t\t0x96\n\n\n/**\n * MASKS and other values. Analog Front End operating modes are defined here.\n *\n */\n#define AS3935_AFE_MASK\t 0b11000001\n#define AS3935_AFE_MASK_2\t 0x3E\n#define AS3935_AFE_OUTDOOR\t 0b00100100\n#define AS3935_AFE_INDOOR\t 0b00011100\n#define AS3935_DISTEST_MASK 0x3F\n#define AS3935_INTRPT_MASK\t0b11110000\n#define AS3935_INTRPT_RESET 0b0000\n\n\n/**\n *\teAS3935Mode - type indicating the operating mode of the AS3935 device.\tThe\n *\tAS3935 offers three modes: Power Down, Listening, and Signal Verification.\tWhen\n *\tultra-low power consumption is important, the application should place the\n *\tdevice in Power Down Mode when lightning measurements are not needed.\n *\n *\tIn Listening Mode the Analog Front End (AFE), noise floor level generation,\n *\tthe bias block, the TRCO, and the voltage regulator (if enabled) are running.\n *\tIn this mode the system can push down the power consumption to a minimum,\n *\t(60\ufffdA). In case the maximum voltage supply does not exceed 3.6V,\n *\tit is possible to switch off the voltage regulator to save power.\n *\n *\tThe AS3935 enters Signal Verification Mode when the watchdog detects activity\n *\tpicked up by the antenna. The IC will leave this mode either if the incoming signal\n *\tis classified as a disturber or if the analysis of the single event (lightning)\n *\tis finished. If the received signal is classified as a disturber, then the AS3935\n *\twill automatically go back to listening mode without any needed action from outside\n *\tand an interrupt will be generated. If the received pattern matches all requirements,\n *\tthe energy calculation is performed and the AS3935 provides distance estimation.\n *\n */\nenum eAS3935Mode\n{\n\tAS3935_PowerDown\t\t\t\t\t\t = 0x0000,\n\tAS3935_Listening\t\t\t\t = 0x0001,\n\tAS3935_SignalVerification\t\t= 0x7000\n};\n\n/**\nInitilizes the sensor.\n*/\nvoid AS3935_Init();\n\n/**\nWrite a 8-bit value to a device register.\tThis function does not do any\nform of error checking, so trying to write to one of the read-only registers may\nresult in undesirable behavior.\n@param addr device register address\n@param data data to be written to the specified register address\n*/\nvoid AS3935_WriteReg(uint8_t addr, uint8_t data);\n//MAY HAVE TO CHANGE BACK DATA TO UINT16_T\n/**\nRead a 8-bit value from a device register.\n@param addr device register address\n@return data read from the specified register address\n*/\nuint8_t AS3935_ReadReg(uint8_t addr);\n\n/**\n * Get the estimated distance to the lightning storm in kilometers.\n * Values beyond 40 are out of range.\n * Values less than 5 mean that the storm is overhead\n*/\nuint8_t AS3935_GetDistanceEstimation();\n\n/**\n * Calibrate the RC Oscillators automatically.\n */\nvoid AS3935_CalibrateRCO();\n\nvoid AS3935_CalibrateLCO();\n\n/**\n * Sets all registers to default mode.\n */\nvoid AS3935_PresetRegisterDefaults();\n\n/*\n * Set the analog front end and watchdog operating mode.\n * Refer above for possible operating modes.\n * @param id device ID (0 to 7) on i2c bus\n * @param mode Operating Mode for AFE, can be AFE_INDOOR or AFE_OUTDOOR.\n */\nvoid AS3935_SetAnalogFrontEnd(uint8_t mode);\n\n/**\n * Retrieve the current operating mode of the AFE and watchdog.\n */\nuint8_t AS3935_GetAnalogFrontEnd();\n\n/**\n * Disable the disturber detection feature on the AS3935.\n */\nvoid AS3935_DisableDisturbers();\n\n/**\n * Enable the disturber detection feature on the AS3935.\n */\nvoid AS3935_EnableDisturbers();\n\n/**\n * Get the defined minimum number of lightning events in the last 17 minutes that issue a lightning interrupt.\n */\nuint8_t AS3935_GetMinimumLightnings();\n\n/**\n * Set the defined minimum number of lightning events in the last 17 minutes that issue a lightning interrupt.\n * @param minimumLightning (1 to 16)\n */\nuint8_t AS3935_SetMinimumLightnings(uint8_t minimumLightning);\n\n/**\n * Get the defined threshold for the noise floor that triggers an interrupt.\n */\nuint8_t AS3935_GetNoiseFloor();\n\n/**\n * Set the defined threshold for the noise floor that triggers an interrupt.\n * @param noiseFloor (0b000 to 0b111)\n */\nuint8_t AS3935_SetNoiseFloor(int noiseFloor);\n\n/**\n * Read the current state of the interrupt register.\n * Issue a 2 millisecond delay per the datasheet recommendations.\n */\nuint8_t AS3935_ReadInterruptRegister();\n\n/**\n* Reset the interrupt register.\n*/\nvoid AS3935_ResetInterruptRegister();\n\n\n#endif\n"
            },
            "objects": {
                "as3935_common.c": "/**\n *\t----------------------------------------------------------------------------\n *\tCopyright (c) 2016, Anaren Microwave, Inc.\n *\n *\tFor more information on licensing, please see Anaren Microwave, Inc's\n *\tend user software licensing agreement: EULA.txt.\n *\n *\t----------------------------------------------------------------------------\n *\n *\tas3935_common.c - driver interface for the ams AG AS3935 Frankling Lightning\n *\tSensor.\n *\n *\t@version\t\t1.0.0\n *\t@date\t\t\t 19 Sep 2016\n *\t@author\t\t Anaren, air@anaren.com\n *\n *\tassumptions\n *\t===========\n *\t- The i2c driver provides the proper signaling sequences for read & write\n *\t\toperations.\n *\t- The i2c driver meets the timing requirements specified in the AS3935\n *\t\tdatasheet.\n *\n *\tfile dependency\n *\t===============\n *\ti2c.h : defines the i2c read & write interfaces.\n *\tmath.h : floating point calculations.\n *\tfp_math.h : floating point calculations using fixed point math.\tUse when math.h not implemented.\n *\n *\trevision history\n *\t================\n *\tver 1.0.00 : 19 September 2016\n *\t- initial development, replace this line upon release.\n */\n#include \"as3935.h\"\n#include \"../i2c/i2c.h\"\n#include \"../gpio/gpio.h\"\n#include \"../generic/generic.h\"\n#include \"../pin_mapping.h\"\n\n// -----------------------------------------------------------------------------\n/**\n *\tGlobal data\n */\nstatic int AS3935_freq = 0;\nstatic int AS3935_mode = 0;\n\n\n// -----------------------------------------------------------------------------\n/**\n *\tPrivate interface\n */\n\n\n\n// -----------------------------------------------------------------------------\n/**\n *\tPublic interface\n */\n\nvoid AS3935_Init()\n{\n\tAS3935_PresetRegisterDefaults();\n\tAS3935_CalibrateRCO();\n\tAS3935_SetAnalogFrontEnd(AIR_AS3935_ANALOG_FRONT_END);\n\tAS3935_SetNoiseFloor((0x02<<4)|(0x02<<0));\n\tAS3935_EnableDisturbers();\n\tAS3935_CalibrateLCO();\n}\n\n/**\n * Write to specified register on the AS3935.\n */\nvoid AS3935_WriteReg(uint8_t addr, uint8_t data)\n{\n\tuint8_t writeBytes[2];\n\twriteBytes[0] = addr;\n\twriteBytes[1] = data;\n\tAIR_I2C_Write(AS3935_I2C_ADDRESS, writeBytes, 2);\n}\n\n/**\n * Read data from specified register\n */\nuint8_t AS3935_ReadReg(uint8_t addr)\n{\n\tuint8_t writeBytes[1] = {0};\n\tuint8_t readBytes[1] = {0};\n\tAIR_I2C_ComboRead(AS3935_I2C_ADDRESS, writeBytes, 1, readBytes, 1);\n\treturn readBytes[0];\n}\n\n/**\n * Get the estimated distance to the lightning storm in kilometers.\n * Also resets the contents of the Interrupt register.\n * Values beyond 40 are out of range.\n * Values less than 5 mean that the storm is overhead.\n */\nuint8_t AS3935_GetDistanceEstimation()\n{\n\tuint8_t distanceEstimate = (uint8_t)AS3935_ReadReg(AS3935_DIST_ESTI_REG_ADDR);\n\n\treturn distanceEstimate & AS3935_DISTEST_MASK;\n}\n\n/**\n * Calibrate the RC Oscillators automatically.\n */\nvoid AS3935_CalibrateRCO()\n{\n\tAS3935_WriteReg(AS3935_CALIBR_RCO_REG_ADDR, AS3935_DIRECT_CMD_REG_VALU);\n}\n\nvoid AS3935_CalibrateLCOIRQHandler()\n{\n\tif (AS3935_mode == 1) {\n\t\tAS3935_freq++;\n\t}\n}\n\n/**\n *\n */\nvoid AS3935_CalibrateLCO()\n{\n\tint i, n, m = 10000, r = 0;\n\t\n\tAIR_GPIO_RegisterInterrupt(AS3935_IRQ_PIN, AS3935_CalibrateLCOIRQHandler, AIR_GPIO_TRIGGER_FALLING_EDGE);\n\tfor(i = 0; i < 0x10; i++)\n\t{\n\t\tAS3935_WriteReg(AS3935_DISP_IRQ_REG_ADDR, 0x80 | i);\n\t\tAIR_GENERIC_UDelay(10000);\n\t\tAS3935_freq = 0;\n\t\tAS3935_mode = 1;\n\t\tAIR_GENERIC_UDelay(100000);\n\t\tAS3935_mode = 0;\n\t\tn = abs(AS3935_freq - 3125);\n\t\tif (m > n) {\n\t\t\tr = i;\n\t\t} else {\n\t\t\tbreak;\n\t\t}\n\t\tm = n;\n\t}\n\tAIR_GPIO_UnregisterInterrupt(AS3935_IRQ_PIN);\n\t\n\tAS3935_WriteReg(AS3935_DISP_IRQ_REG_ADDR, r);\n}\n\n/**\n * Sets all registers in default mode\n */\nvoid AS3935_PresetRegisterDefaults()\n{\n\tAS3935_WriteReg(AS3935_PRESET_DEF_REG_ADDR, AS3935_DIRECT_CMD_REG_VALU);\n}\n\n/*\n * Set the analog front end and watchdog operating mode.\n * Refer to as3935.h for possible operating modes.\n */\nvoid AS3935_SetAnalogFrontEnd(uint8_t mode)\n{\n\tuint8_t newAFESetting;\n\tuint8_t currentAFESetting = AS3935_ReadReg(AS3935_PWD_AFEGB_REG_ADDR);\n\tcurrentAFESetting = currentAFESetting & AS3935_AFE_MASK;\n\tif (mode == AS3935_AFE_OUTDOOR)\n\t{\n\tnewAFESetting = currentAFESetting & AS3935_AFE_OUTDOOR;\n\t\tAS3935_WriteReg(AS3935_PWD_AFEGB_REG_ADDR, newAFESetting);\n\t}\n\n\tif (mode == AS3935_AFE_INDOOR)\n\t{\n\tnewAFESetting = currentAFESetting & AS3935_AFE_OUTDOOR;\n\t\tAS3935_WriteReg(AS3935_PWD_AFEGB_REG_ADDR, newAFESetting);\n\t}\n}\n\n/**\n * Retrieve the current operating mode of the AFE and watchdog.\n */\nuint8_t AS3935_GetAnalogFrontEnd()\n{\n\treturn ((uint8_t)AS3935_ReadReg(AS3935_PWD_AFEGB_REG_ADDR) & AS3935_AFE_MASK_2) >> 1;\n}\n\n/**\n * Disable the disturber detection feature on the AS3935.\n */\nvoid AS3935_DisableDisturbers()\n{\n\tAS3935_WriteReg(AS3935_MASK_DIST_REG_ADDR, 1);\n}\n\n/**\n * Enable the disturber detection feature on the AS3935.\n */\nvoid AS3935_EnableDisturbers()\n{\n\tAS3935_WriteReg(AS3935_MASK_DIST_REG_ADDR, 0);\n}\n\n/**\n * Get the defined minimum number of lightning events in the last 17 minutes that issue a lightning interrupt.\n */\nuint8_t AS3935_GetMinimumLightnings()\n{\n\treturn AS3935_ReadReg(AS3935_MIN_LIGHT_REG_ADDR);\n}\n\n/**\n * Set the defined minimum number of lightning events in the last 17 minutes that issue a lightning interrupt.\n */\nuint8_t AS3935_SetMinimumLightnings(uint8_t minimumLightning)\n{\n\tAS3935_WriteReg(AS3935_MIN_LIGHT_REG_ADDR, minimumLightning);\n\treturn AS3935_GetMinimumLightnings();\n}\n\n/**\n * Get the defined threshold for the noise floor that triggers an interrupt.\n */\nuint8_t AS3935_GetNoiseFloor()\n{\n\treturn AS3935_ReadReg(AS3935_NFLV_WDTH_REG_ADDR);\n}\n\n/**\n * Set the defined threshold for the noise floor that triggers an interrupt.\n */\nuint8_t AS3935_SetNoiseFloor(int noiseFloor)\n{\n\tAS3935_WriteReg(AS3935_NFLV_WDTH_REG_ADDR, noiseFloor);\n\treturn AS3935_GetNoiseFloor();\n}\n\n/**\n * Read current state of the interrupt register.\n * Issue a 2 millisecond delay per the datasheet recommendations.\n */\nuint8_t AS3935_ReadInterruptRegister()\n{\n\treturn (uint8_t)AS3935_ReadReg(AS3935_MASK_DIST_REG_ADDR);\n}\n\n\n"
            },
            "other": {}
        }
    },
    "label": "AS3935 Driver",
    "language": {
        "en": {
            "label": "AS3935 Driver"
        }
    },
    "links": {
        "Datasheet": "http://www.embeddedadventures.com/datasheets/AS3935_Datasheet_EN_v2.pdf",
        "Product Page": "http://www.embeddedadventures.com/as3935_lightning_sensor_module_mod-1016.html",
        "Wiki Page": "https://atmosphere.anaren.com/wiki/AS3935_Driver"
    },
    "manufacturer": "Embedded Adventures",
    "name": "as3935",
    "signature": "",
    "type": "Embedded Library",
    "version": "1.0.0"
}